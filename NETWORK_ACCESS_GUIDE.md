# ğŸŒ HMML2 å†…ç½‘/è·¨ä¸»æœºè®¿é—®æŒ‡å—

## æ¦‚è¿°

HMML2 ç°åœ¨æ”¯æŒ**æ™ºèƒ½ API åœ°å€è‡ªåŠ¨é…ç½®**ï¼Œæ— è®ºæ˜¯ Docker éƒ¨ç½²è¿˜æ˜¯æºç éƒ¨ç½²ï¼Œéƒ½èƒ½è‡ªåŠ¨é€‚é…å†…ç½‘è®¿é—®ï¼

## âœ¨ è‡ªåŠ¨é…ç½®åŸç†

å‰ç«¯ä¼šæ ¹æ®å½“å‰è®¿é—®åœ°å€è‡ªåŠ¨æ¨æ–­åç«¯ API åœ°å€ï¼š

```
è®¿é—®åœ°å€                        â†’ API åœ°å€
http://localhost:5173          â†’ http://localhost:7999/api
http://localhost:7998          â†’ http://localhost:7999/api
http://192.168.1.100:5173      â†’ http://192.168.1.100:7999/api
http://192.168.1.100:7998      â†’ http://192.168.1.100:7999/api
http://your-domain.com:7998    â†’ http://your-domain.com:7999/api
```

**å…³é”®ç‚¹**: å‰ç«¯ä¼šä½¿ç”¨**ä½ è®¿é—®æ—¶çš„ä¸»æœºåœ°å€**æ¥æ„å»º API åœ°å€ï¼

## ğŸ“‹ æ”¯æŒçš„éƒ¨ç½²æ–¹å¼

### âœ… æ–¹å¼ 1: Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

**æœåŠ¡å™¨ä¸Š (192.168.1.100)**:
```bash
docker compose up -d
```

**å…¶ä»–ç”µè„‘æµè§ˆå™¨è®¿é—®**:
```
http://192.168.1.100:7998
```

**è‡ªåŠ¨é…ç½®ç»“æœ**:
- API åœ°å€: `http://192.168.1.100:7999/api` âœ…
- æ— éœ€ä»»ä½•é…ç½®ï¼

---

### âœ… æ–¹å¼ 2: æºç éƒ¨ç½²ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

**æœåŠ¡å™¨ä¸Š (192.168.1.100)**:
```bash
# å¯åŠ¨åç«¯
cd backend
python start.py  # é»˜è®¤ç›‘å¬ 0.0.0.0:7999

# å¯åŠ¨å‰ç«¯
cd frontend
pnpm dev -- --host  # å…³é”®ï¼šæ·»åŠ  --host å‚æ•°å…è®¸å¤–éƒ¨è®¿é—®
```

**å…¶ä»–ç”µè„‘æµè§ˆå™¨è®¿é—®**:
```
http://192.168.1.100:5173
```

**è‡ªåŠ¨é…ç½®ç»“æœ**:
- API åœ°å€: `http://192.168.1.100:7999/api` âœ…
- æ— éœ€ä»»ä½•é…ç½®ï¼

---

### âœ… æ–¹å¼ 3: ç”Ÿäº§æ„å»ºéƒ¨ç½²

**æœåŠ¡å™¨ä¸Š (192.168.1.100)**:
```bash
# 1. æ„å»ºå‰ç«¯
cd frontend
pnpm build

# 2. å¯åŠ¨åç«¯
cd ../backend
python start.py

# 3. å¯åŠ¨å‰ç«¯é™æ€æœåŠ¡å™¨
cd ../frontend
node server.cjs
```

**å…¶ä»–ç”µè„‘æµè§ˆå™¨è®¿é—®**:
```
http://192.168.1.100:7998
```

**è‡ªåŠ¨é…ç½®ç»“æœ**:
- API åœ°å€: `http://192.168.1.100:7999/api` âœ…
- æ— éœ€ä»»ä½•é…ç½®ï¼

## ğŸ”§ è¯¦ç»†é…ç½®è¯´æ˜

### åç«¯é…ç½®

åç«¯éœ€è¦ç›‘å¬ `0.0.0.0` ä»¥å…è®¸å¤–éƒ¨è®¿é—®ã€‚

**æ£€æŸ¥é…ç½®æ–‡ä»¶** `backend/config/server.json`:
```json
{
  "server": {
    "host": "0.0.0.0",  // âœ… å¿…é¡»æ˜¯ 0.0.0.0ï¼Œä¸èƒ½æ˜¯ 127.0.0.1
    "port": 7999
  },
  "security": {
    "cors_enabled": true,       // âœ… å¿…é¡»å¯ç”¨ CORS
    "cors_origins": ["*"]       // âœ… å…è®¸æ‰€æœ‰æ¥æºï¼ˆæˆ–æŒ‡å®š IPï¼‰
  }
}
```

### å‰ç«¯é…ç½®

#### å¼€å‘æ¨¡å¼ (Vite)

**å¯åŠ¨æ—¶æ·»åŠ  `--host` å‚æ•°**:
```bash
# æ–¹å¼ 1: å‘½ä»¤è¡Œ
pnpm dev -- --host

# æ–¹å¼ 2: ä¿®æ”¹ package.json
{
  "scripts": {
    "dev": "vite --host"
  }
}

# æ–¹å¼ 3: ä¿®æ”¹ vite.config.ts
export default defineConfig({
  server: {
    host: '0.0.0.0',  // å…è®¸å¤–éƒ¨è®¿é—®
    port: 5173
  }
})
```

#### ç”Ÿäº§æ¨¡å¼

ç”Ÿäº§æ¨¡å¼ä¸‹ `server.cjs` å·²é»˜è®¤ç›‘å¬ `0.0.0.0`ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

## ğŸ¯ éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ

### 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·

è®¿é—®å‰ç«¯é¡µé¢åï¼ŒæŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·ã€‚

### 2. æŸ¥çœ‹ Console æ—¥å¿—

ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä¿¡æ¯ï¼š
```
[HMML] API Base URL è‡ªåŠ¨è®¾ç½®ä¸º: http://192.168.1.100:7999/api
[HMML] éƒ¨ç½²æ¨¡å¼: å¼€å‘æ¨¡å¼/Dockeræ¨¡å¼/è‡ªå®šä¹‰æ¨¡å¼
```

### 3. æ£€æŸ¥ Network è¯·æ±‚

åœ¨ Network æ ‡ç­¾é¡µä¸­ï¼ŒæŸ¥çœ‹ API è¯·æ±‚çš„åœ°å€ï¼š
- âœ… æ­£ç¡®: `http://192.168.1.100:7999/api/...`
- âŒ é”™è¯¯: `http://localhost:7999/api/...`

å¦‚æœçœ‹åˆ° `localhost`ï¼Œè¯´æ˜è‡ªåŠ¨é…ç½®æœªç”Ÿæ•ˆï¼

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: API è¯·æ±‚ 404 æˆ–ç½‘ç»œé”™è¯¯

**å¯èƒ½åŸå› **:
- åç«¯æœªç›‘å¬ `0.0.0.0`
- é˜²ç«å¢™é˜»æ­¢äº†ç«¯å£ 7999
- åç«¯æœªå¯åŠ¨

**è§£å†³æ­¥éª¤**:

1. **æ£€æŸ¥åç«¯æ˜¯å¦å¯è®¿é—®**:
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•
curl http://localhost:7999/api/health

# åœ¨å…¶ä»–ç”µè„‘æµ‹è¯•
curl http://192.168.1.100:7999/api/health
```

2. **æ£€æŸ¥åç«¯ç›‘å¬åœ°å€**:
```bash
# Linux/macOS
netstat -tuln | grep 7999

# Windows
netstat -an | findstr 7999
```

åº”è¯¥çœ‹åˆ° `0.0.0.0:7999` è€Œä¸æ˜¯ `127.0.0.1:7999`

3. **æ£€æŸ¥é˜²ç«å¢™**:
```bash
# Linux (firewalld)
sudo firewall-cmd --add-port=7999/tcp --permanent
sudo firewall-cmd --reload

# Linux (ufw)
sudo ufw allow 7999/tcp

# Windows
# åœ¨ Windows é˜²ç«å¢™ä¸­æ·»åŠ å…¥ç«™è§„åˆ™å…è®¸ 7999 ç«¯å£
```

### é—®é¢˜ 2: CORS é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
Access to XMLHttpRequest at 'http://192.168.1.100:7999/api/...' 
from origin 'http://192.168.1.100:5173' has been blocked by CORS policy
```

**è§£å†³æ–¹æ¡ˆ**:

ç¼–è¾‘ `backend/config/server.json`:
```json
{
  "security": {
    "cors_enabled": true,
    "cors_origins": ["*"]  // æˆ–æŒ‡å®š: ["http://192.168.1.100:5173"]
  }
}
```

ç„¶åé‡å¯åç«¯æœåŠ¡ã€‚

### é—®é¢˜ 3: å‰ç«¯æ— æ³•ä»å¤–éƒ¨è®¿é—®

**é—®é¢˜**:
- åœ¨æœåŠ¡å™¨ä¸Šè®¿é—® `http://localhost:5173` æ­£å¸¸
- åœ¨å…¶ä»–ç”µè„‘è®¿é—® `http://192.168.1.100:5173` æ— æ³•æ‰“å¼€

**è§£å†³æ–¹æ¡ˆ**:

ç¡®ä¿ Vite ä½¿ç”¨ `--host` å‚æ•°å¯åŠ¨ï¼š
```bash
pnpm dev -- --host
```

æˆ–è€…ä¿®æ”¹ `vite.config.ts`:
```typescript
export default defineConfig({
  server: {
    host: '0.0.0.0'  // æ·»åŠ è¿™è¡Œ
  }
})
```

### é—®é¢˜ 4: API åœ°å€ä»ç„¶æ˜¯ localhost

**æ£€æŸ¥æ­¥éª¤**:

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾é¡µ
3. åˆ·æ–°é¡µé¢
4. æŸ¥æ‰¾ `[HMML] API Base URL è‡ªåŠ¨è®¾ç½®ä¸º:` æ¶ˆæ¯

**å¯èƒ½åŸå› **:
- æµè§ˆå™¨ç¼“å­˜äº†æ—§çš„ index.html
- æ„å»ºæ—¶æ²¡æœ‰åŒ…å«æ–°çš„ index.html

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶å¼ºåˆ¶åˆ·æ–°
Ctrl + Shift + R  (Windows/Linux)
Cmd + Shift + R   (macOS)

# é‡æ–°æ„å»ºå‰ç«¯
cd frontend
rm -rf dist
pnpm build
```

## ğŸ“± ç§»åŠ¨è®¾å¤‡è®¿é—®

ç§»åŠ¨è®¾å¤‡ï¼ˆæ‰‹æœº/å¹³æ¿ï¼‰ä¹Ÿå¯ä»¥è®¿é—®ï¼

**å‰æ**:
- ç§»åŠ¨è®¾å¤‡å’ŒæœåŠ¡å™¨åœ¨åŒä¸€å±€åŸŸç½‘
- çŸ¥é“æœåŠ¡å™¨çš„ IP åœ°å€

**è®¿é—®æ–¹å¼**:
```
http://192.168.1.100:7998
```

API åœ°å€ä¼šè‡ªåŠ¨é…ç½®ä¸º `http://192.168.1.100:7999/api`

## ğŸŒ å…¬ç½‘è®¿é—®é…ç½®

å¦‚æœéœ€è¦é€šè¿‡å…¬ç½‘è®¿é—®ï¼ˆä½¿ç”¨åŸŸåæˆ–å…¬ç½‘ IPï¼‰ï¼Œéœ€è¦é¢å¤–é…ç½®ï¼š

### æ–¹å¼ 1: ä½¿ç”¨åå‘ä»£ç†ï¼ˆæ¨èï¼‰

ä½¿ç”¨ Nginx/Caddy ç»Ÿä¸€å‰åç«¯ç«¯å£ï¼š

**Nginx é…ç½®**:
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯
    location / {
        proxy_pass http://localhost:7998;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # åç«¯ API
    location /api {
        proxy_pass http://localhost:7999;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

è®¿é—® `http://your-domain.com` å³å¯ï¼ŒAPI è‡ªåŠ¨ä¸º `/api`

### æ–¹å¼ 2: æ‰‹åŠ¨æŒ‡å®š API åœ°å€

åœ¨ `frontend/index.html` çš„ `<head>` å¼€å¤´æ·»åŠ ï¼š

```html
<script>
  // åœ¨è‡ªåŠ¨é…ç½®è„šæœ¬ä¹‹å‰è®¾ç½®
  window.__HMML_API_BASE__ = 'https://api.your-domain.com/api';
</script>
```

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

### å†…ç½‘è®¿é—®
- âœ… ä½¿ç”¨å†…ç½‘ IPï¼Œç›¸å¯¹å®‰å…¨
- âœ… å¯ä»¥ä½¿ç”¨ HTTP
- âš ï¸ å»ºè®®é™åˆ¶ IP ç™½åå•

### å…¬ç½‘è®¿é—®
- âœ… **å¿…é¡»ä½¿ç”¨ HTTPS**
- âœ… **å¿…é¡»é…ç½®å¼º Token**
- âœ… **å»ºè®®ä½¿ç”¨åå‘ä»£ç†**
- âœ… **é™åˆ¶ CORS æ¥æº**
- âœ… **å¯ç”¨é˜²ç«å¢™è§„åˆ™**

## ğŸ“Š å„éƒ¨ç½²æ–¹å¼å¯¹æ¯”

| éƒ¨ç½²æ–¹å¼ | éš¾åº¦ | å†…ç½‘è®¿é—® | è‡ªåŠ¨é…ç½® | æ¨èåœºæ™¯ |
|---------|------|---------|---------|---------|
| Docker | â­ ç®€å• | âœ… | âœ… | ç”Ÿäº§ç¯å¢ƒ |
| æºç å¼€å‘ | â­â­ ä¸­ç­‰ | âœ… | âœ… | å¼€å‘è°ƒè¯• |
| ç”Ÿäº§æ„å»º | â­â­â­ å¤æ‚ | âœ… | âœ… | æ‰‹åŠ¨éƒ¨ç½² |

## ğŸ“ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ
```bash
# åç«¯
cd backend
python start.py

# å‰ç«¯
cd frontend
pnpm dev -- --host

# è®¿é—®: http://localhost:5173 æˆ– http://<your-ip>:5173
```

### æµ‹è¯•ç¯å¢ƒ
```bash
# ä½¿ç”¨ Docker
docker compose up -d

# è®¿é—®: http://localhost:7998 æˆ– http://<your-ip>:7998
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# ä½¿ç”¨ Docker + Nginx åå‘ä»£ç†
docker compose up -d
# é…ç½® Nginx
# é…ç½® HTTPS (Let's Encrypt)
# è®¿é—®: https://your-domain.com
```

## ğŸ’¡ å¿«é€Ÿæµ‹è¯•å‘½ä»¤

### æµ‹è¯•åç«¯å¯è®¿é—®æ€§
```bash
# ä»æœåŠ¡å™¨æœ¬åœ°
curl http://localhost:7999/api/health

# ä»å…¶ä»–æœºå™¨
curl http://192.168.1.100:7999/api/health

# åº”è¯¥è¿”å› JSON æ ¼å¼çš„å¥åº·ä¿¡æ¯
```

### æµ‹è¯•å‰ç«¯å¯è®¿é—®æ€§
```bash
# ä»å…¶ä»–æœºå™¨
curl http://192.168.1.100:5173  # å¼€å‘æ¨¡å¼
curl http://192.168.1.100:7998  # ç”Ÿäº§æ¨¡å¼

# åº”è¯¥è¿”å› HTML å†…å®¹
```

### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
# Docker éƒ¨ç½²
docker logs -f hmml-unified

# æºç éƒ¨ç½² - åç«¯æ—¥å¿—
tail -f backend/logs/hmml.log

# å‰ç«¯åœ¨æµè§ˆå™¨ Console ä¸­æŸ¥çœ‹
```

## ğŸ‰ æ€»ç»“

ç°åœ¨ï¼Œ**æ— è®ºæ˜¯ Docker éƒ¨ç½²è¿˜æ˜¯æºç éƒ¨ç½²**ï¼ŒHMML2 éƒ½æ”¯æŒå†…ç½‘/è·¨ä¸»æœºè®¿é—®çš„ API åœ°å€è‡ªåŠ¨é…ç½®ï¼

**å…³é”®è¦ç‚¹**:
1. âœ… åç«¯ç›‘å¬ `0.0.0.0`
2. âœ… å¯ç”¨ CORS
3. âœ… å‰ç«¯ä½¿ç”¨ `--host` (å¼€å‘æ¨¡å¼)
4. âœ… é˜²ç«å¢™å…è®¸ç«¯å£
5. âœ… æµè§ˆå™¨ Console éªŒè¯é…ç½®

**å¿«é€Ÿå¼€å§‹**:
```bash
# Docker
docker compose up -d

# æºç 
cd backend && python start.py &
cd frontend && pnpm dev -- --host

# è®¿é—®
http://<your-ip>:7998  # Docker
http://<your-ip>:5173  # æºç 
```

äº«å—æ— ç¼çš„å†…ç½‘è®¿é—®ä½“éªŒï¼ğŸš€
